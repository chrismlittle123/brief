# Brief - V4 Specification

> Fill in the gaps, keep it brief.

V4 builds on the [V3 spec](./v3.md) with mobile-first optimizations that make the voice agent work reliably on phones — the "airpods in the park" experience.

## New Features

### 1. Background Audio & Screen Lock Handling

**The problem:** iOS Safari suspends WebRTC when the browser tab goes to background or the screen locks. This is a hard OS-level restriction — no web API can override it. Android is more permissive but still unreliable.

**V4 approach (web-only, pragmatic):**

1. **Wake Lock API**: Request a screen wake lock when the call starts. This prevents the screen from auto-dimming while the user is walking/talking. The screen stays on in their pocket.

2. **Graceful disconnection**: If the connection drops (user locks phone, takes a call, etc.), the session state is already saved (V3 session resilience). No progress is lost.

3. **Fast reconnect**: When the user comes back, the page detects the stale connection and shows a single "Resume" button. One tap → back in the conversation.

4. **Audio focus hint**: On session start, show a brief toast: *"Keep your screen on for uninterrupted audio. Your progress is saved if you need to step away."*

**What this means in practice:**

| Scenario | What happens |
|----------|-------------|
| Screen stays on (Wake Lock active) | Uninterrupted — full conversation flows |
| User manually locks phone | WebRTC drops. Come back, tap Resume, pick up where you left off |
| Incoming phone call | WebRTC drops. After the call, return to browser, tap Resume |
| Lose signal briefly | LiveKit reconnects automatically (built-in ICE restart). If it fails, Resume flow |
| App killed / crash | Return to URL, Resume flow picks up at last saved question |

### 2. Mobile-First Voice Session UI

Optimize the `/call/[sessionId]` page for phone use:

- Large, tappable buttons (minimum 44px touch targets)
- No scrolling needed during the call — everything visible in viewport
- Works in both iOS Safari and Android Chrome
- Wakelock to prevent screen from sleeping during the call
- Landscape and portrait orientation support

**Mobile user flow:**

1. **Open app**: User navigates to Brief web app on phone (Clerk authenticated)
2. **Start session**: Taps "Start Check-in" on dashboard → `/call/new`
3. **Mic permission**: Browser prompts for microphone (one-time)
4. **Talking**: Agent greets them, conversation starts — user walks and talks
5. **Done**: Report appears, tap "Save to Notion"

### 3. Native App Wrapper (Future Preparation)

V4 does not ship a native app, but the architecture is designed to support one:

- A thin native iOS/Android app (React Native, Expo, or Capacitor) with a background audio entitlement would solve the screen-lock problem completely
- The audio session stays alive in the background, and the OS shows a green pill / notification bar
- This is the only way to get true "pocket mode" on iOS
- The native app would connect to the same LiveKit rooms and use the same backend APIs — no backend changes needed

## No New API Routes

V4 is purely a frontend/UX improvement. All API routes from V3 remain unchanged.

## No New Environment Variables

No additional configuration needed. V4 uses the same environment variables as V3.

## Updated User Flow

Same as V3, but optimized for mobile:

1. User opens Brief web app on phone, logs in via Clerk
2. Taps "Start Check-in" → new voice session created
3. Wake Lock activates — screen stays on
4. Agent asks 4 questions conversationally (~3 min) — user walks and talks
5. If interrupted (phone call, signal loss) → come back, tap Resume
6. Report is generated, agent reads it back
7. User edits by voice until satisfied
8. User says "save it" → report saved to Notion
